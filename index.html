<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link href="css/icons.css" rel="stylesheet" />
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style> 
      header, main, footer {
        padding-left: 300px;
      }

      @media only screen and (max-width : 992px) {
        header, main, footer {
          padding-left: 0;
        }
      }
      a.page-title {
        font-size: 36px;
      }
    </style>
    <script>
      function init(){
        $(".button-collapse").sideNav();
        changetitle();
        $(document).ready(function(){
          // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
          $('.modal').modal();
        });
        showQuestion(0);
      }; 
      var questions = [];
      var question_bank;
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          question_bank = this.responseText;
          var question_strings = question_bank.split("<br></>\r\n<br></>\r\n<br></>\r\n");
          for(i = 0;i < question_strings.length;i++){
            var question = {};
            question.title = question_strings[i].substring(0,question_strings[i].indexOf("<br>"));
            question.content = question_strings[i].substring(question_strings[i].indexOf("<br>"));
            questions.push(question);
          }
        }
      };
      xhttp.open("GET", "data/question_bank.txt", true);
      xhttp.send();

     
      function changetitle(){
        for(i = 0; i < questions.length; i++){
          let new_li = document.createElement("li");
          let new_a = document.createElement("a");
          let new_text = document.createTextNode(questions[i].title);
          new_li.appendChild(new_a);
          new_a.appendChild(new_text);
          document.getElementById("nav-mobile").appendChild(new_li);
          new_li.setAttribute("class", "bold");
          new_a.setAttribute("href", "#");
          new_a.setAttribute("onclick", "showQuestion(" + i + ")");
          new_a.setAttribute("class", "waves-effect waves-teal");
        };
      };
      function change_img(){
        var x = document.getElementById("question_content");
        var y = x.getElementsByTagName("img");
        for(i = 0; i < y.length; i++){
          y[i].setAttribute("src", "data/"+y[i].getAttribute("src"));
          y[i].classList.add("responsive-img");
        }
      }
      function showQuestion(no){
        document.getElementById("question_content").innerHTML = questions[no].content;
        if(no != 0){
            document.getElementById("lastQuestion").setAttribute("onclick", "showQuestion("+ (no - 1) +")");  
          };
        if(no != questions.length){
            document.getElementById("nextQuestion").setAttribute("onclick", "showQuestion("+ (no + 1) +")");  
          }
          change_img();
          var x = document.getElementById("question_content");
          var y = x.getElementsByTagName("a");
          
          if(y.length == 0){
            return;
          }
          var z = y[0].getAttribute("href");
          y[0].setAttribute("href","#modal1");
          y[0].setAttribute("class","waves-effect waves-light btn");
          loadDoc(z);
      }   
      
    </script> 
  </head>

  <body onload="init()">
    <header>
      <nav class="top-nav">
        <div class="container">
        <div class="nav-wrapper">
          <a class="page-title">题库</a>
          <a href="#" data-activates="nav-mobile" class="button-collapse top-nav waves-effect waves-light circle hide-on-large-only">
            <i class="material-icons">menu</i>
          </a>
        </div>
        </div>
      </nav>  
      <ul id="nav-mobile" class="side-nav fixed" style="transform: translateX(-100%);"></ul>


    </header>
    <main>
      <div class="container">
        <div class="row">
          <div class="col s12">
            <div class="card grey darken-1">
              <div class="card-content white-text">
                <div class="container center-align">
                  <div class="row white-text">
                    <div class="col s5"><a id="lastQuestion" href="#" class="waves-effect waves-light btn">上一题</a></div> 
                    <div class="col s2"></div>   
                    <div class="col s5"><a id="nextQuestion" href="#" class="waves-effect waves-light btn">下一题</a></div>  
                  </div>
                  <div class="row"></div>
                  <div class="row">
                    <div class="col s12 left-align">
                      <p id="question_content"></p>
                    </div>
                  </div>
              </div>
              <div class="card-action">
                  <!-- Modal Trigger -->
              <!-- <a class="waves-effect waves-light btn" href="#modal1">答案及解析</a> -->

              <!-- Modal Structure -->
              <div id="modal1" class="modal">
                <div class="modal-content black-text">
                  <p id = "modal_answer"></p>
                  
                </div>
                <script>

                  
                    function loadDoc(z) {

                      function checkImg(){undefined
                      var img_id=z; //根据id得到值
                      var index= img_id.lastIndexOf("."); //（考虑严谨用lastIndexOf(".")得到）得到"."在第几位
                      img_id=img_id.substring(index); //截断"."之前的，得到后缀
                          if(img_id!=".txt"){  //根据后缀，判断是否符合图片格式
                            document.getElementById("modal_answer").innerHTML ="";
                            let new_img = document.createElement("img");
                            document.getElementById("modal_answer").appendChild(new_img);
                            new_img.setAttribute("src", "data/"+z);          
                            new_img.setAttribute("class", "responsive-img");

                            }
                            
                          else{
                           
                            var xhttp = new XMLHttpRequest();
                            xhttp.onreadystatechange = function() {
                              if (this.readyState == 4 && this.status == 200) {
                                document.getElementById("modal_answer").innerHTML = this.responseText;
                              }
                            };
                            xhttp.open("GET", "data/"+z, true);
                            xhttp.send();
                          }
                      } 
                      checkImg();
                    }
                    </script>
              </div>
              </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>  
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/materialize.min.js"></script>
  </body>
</html>